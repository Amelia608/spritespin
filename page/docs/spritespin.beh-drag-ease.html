<!DOCTYPE html>

<html>
<head>
  <title>spritespin.beh-drag-ease.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>spritespin.beh-drag-ease.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">$, SpriteSpin</span>) </span>{
<span class="hljs-pi">  "use strict"</span>;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init</span>(<span class="hljs-params">e, data</span>)</span>{
    data.modEase = { samples: [], steps: [] };
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">drag</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">var</span> data = $(<span class="hljs-keyword">this</span>).spritespin(<span class="hljs-string">'data'</span>);
    <span class="hljs-keyword">if</span> (!data.dragging) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-keyword">var</span> ease = data.modEase;

    <span class="hljs-keyword">if</span> (ease.timeout) {
      <span class="hljs-built_in">window</span>.clearTimeout(ease.timeout);  
      <span class="hljs-keyword">delete</span> ease.timeout;
    }
    
    ease.capture.push({
      time: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime(),
      frame: data.frame
    });
    <span class="hljs-keyword">while</span> (ease.capture.length &gt; <span class="hljs-number">5</span>) {
      ease.capture.shift()
    }
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dragEnd</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">var</span> data = $(<span class="hljs-keyword">this</span>).spritespin(<span class="hljs-string">'data'</span>);
    <span class="hljs-keyword">var</span> ease = data.modEase;
    <span class="hljs-keyword">if</span> (data.loading || data.dragging || !data.stage.is(<span class="hljs-string">':visible'</span>)){
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">var</span> sample, last, frames = <span class="hljs-number">0</span>, time = <span class="hljs-number">0</span>, samples = ease.samples;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, i &lt; samples.length, i += <span class="hljs-number">1</span>) {
      sample = samples[i];
      <span class="hljs-keyword">if</span> (last) {
        frames += last.frame - sample.frame;
        time += last.time - sample.time;
      }
      last = sample;
    }
    <span class="hljs-keyword">if</span> (time &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">var</span> fps = frames / time;
    <span class="hljs-keyword">var</span> steps = ease.steps;
    steps.length = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span>(fps &gt; <span class="hljs-number">0.01</span>) {
      steps.push(fps);
      fps *= <span class="hljs-number">0.9</span>;
    }

    ease.frame = data.frame;
    ease.frames = <span class="hljs-number">0</span>;
    ease.timeout = <span class="hljs-built_in">window</span>.setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
      tick(data, ease);
    }, <span class="hljs-number">16</span>)
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tick</span>(<span class="hljs-params">data, ease</span>)</span>{
    <span class="hljs-keyword">var</span> step = ease.steps.shift();
    <span class="hljs-keyword">if</span> (!step) <span class="hljs-keyword">return</span>;

    ease.frames += step * <span class="hljs-number">0.016</span>;
    SpriteSpin.updateFrame(data, ease.frame + ease.frames)

    ease.timeout = <span class="hljs-built_in">window</span>.setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
      tick(data, ease);
    }, <span class="hljs-number">16</span>)
  }

  SpriteSpin.registerModule(<span class="hljs-string">'ease'</span>, {
    onLoad: init,

    mousemove: drag,
    mouseup: dragEnd,

    touchmove: drag,
    touchend: dragEnd
  });

}(<span class="hljs-built_in">window</span>.jQuery || <span class="hljs-built_in">window</span>.Zepto || <span class="hljs-built_in">window</span>.$, <span class="hljs-built_in">window</span>.SpriteSpin));</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
